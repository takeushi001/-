# 自動音声通話システム

自動音声通話システムのリポジトリへようこそ！このシステムは、不動産物件の空き状況や詳細情報を確認するための自動通話プロセスを提供します。Twilioを使用した自動発信とOpenAIのChatGPTを活用して、効率的な情報収集を可能にします。

## 🚀 特徴

- **自動発信と音声応答**: Twilioを用いて自動的に電話を発信し、相手の応答をリアルタイムで分析します。
- **AIによる応答生成**: ChatGPTを利用して、相手の発言に対する適切な応答を生成。リアルタイムで会話を進行します。
- **音声テキスト化と会話履歴保存**: 音声をテキスト化し、会話履歴を保存。データ分析や再利用が可能です。
- **Excelファイルへの情報記録**: 通話内容から得られた情報をExcelファイルに自動的に記録し、管理しやすい形式で出力します。

## 📋 必要条件

このプロジェクトを動作させるには、以下のツール・ライブラリが必要です：

- Python 3.x
- Flask
- Twilio
- OpenAI
- Pandas
- Pydub
- Openpyxl
- Dotenv
- Ngrok
- Requests
- Pyngrok

## 📥 インストール

リポジトリをクローンし、次のコマンドを実行して必要な依存関係をインストールしてください：

```
pip install flask twilio openai pandas pydub openpyxl python-dotenv pyngrok requests
```

## ⚙️ セットアップと使い方

1. **環境変数の設定**: `.env` ファイルを作成し、TwilioやOpenAIの認証情報を設定します。以下は例です：

   ```
   TWILIO_SID=your_twilio_sid
   TWILIO_AUTH_TOKEN=your_twilio_auth_token
   TWILIO_PHONE_NUMBER=your_twilio_phone_number
   OPENAI_API_KEY=your_openai_api_key
   ```

2. **Excelファイルの準備**: 物件情報が記載されたExcelファイルを用意します。このファイルから電話番号やビル情報を取得します。

3. **実行**: 次のコマンドでサーバーを起動し、自動通話を開始します：

   ```
   python auto_call_system.py
   ```

## 📊 システムのメイン動作

1. **Flaskサーバーの起動とNgrokによる公開**

   - **Flaskサーバーの起動**: Flaskサーバーをローカルで起動し、Twilioからのリクエストを処理するエンドポイントを用意します。これにより、電話の自動発信、音声応答の再生、録音データの処理などの一連の操作を管理します。
   - **NgrokによるFlaskサーバーの公開**: Ngrokを使用してローカルのFlaskサーバーをインターネット上に公開し、TwilioのWebhooksがアクセス可能な状態にします。これにより、Twilioとの連携がスムーズに行え、通話の流れをシームレスに制御できます。

2. **電話の自動発信**

   - **Twilio APIを使用して自動発信**: Excelファイルに記載された情報に基づき、Twilio APIを用いて指定された電話番号に自動で電話をかけます。この機能は、数多くの物件に対して一括で発信できるため、大幅に手間を削減し、効率的な情報収集を実現します。また、通話中に自動応答を活用することで、常に適切な対応が行えるようになっています。

3. **挨拶と応答生成**

   - **最初の挨拶**: 通話が接続されると、システムはまず最初に相手に挨拶を行います。この挨拶はChatGPTを使用して生成され、相手に安心感を与えるよう丁寧で適切な内容になっています。相手に対してこちらの会社名や用件を伝えることで、スムーズなコミュニケーションのスタートを切ることができます。

4. **通話音声の記録**

   - **音声の録音**: 挨拶の後、相手の応答が自動的に録音されます。この録音は通話の全体をリアルタイムで行い、後でテキスト化して分析に活用します。録音されたデータは、通話の品質向上や、取得した情報の正確な確認に役立ちます。

5. **Whisperによる通話音声のテキスト化**

   - **音声をテキストに変換**: 録音した音声はWhisper APIを用いてテキスト化されます。このプロセスにより、相手の発言内容を文字データとして記録し、次の応答生成に利用します。テキスト化によって、人の手を介さずとも会話内容の把握が可能となり、情報収集プロセスが大幅に簡略化されます。

6. **ChatGPTによる応答文章の生成**

   - **ChatGPTによる応答生成**: テキスト化された内容を基に、ChatGPTを用いて適切な応答を生成します。この応答は相手の質問や要望に対して的確に応じるためのものであり、相手とのやり取りをスムーズに進行させます。また、AIを利用することで、人間らしい自然な会話を実現し、相手にとって快適な通話体験を提供します。

7. **Text-to-Speechによる音声合成とその再生**

   - **応答の音声再生**: 生成された応答は音声ファイルとして作成され、Twilioを通じて相手に再生されます。この音声応答により、会話が自動で進行し、情報の収集がよりシームレスに行えます。また、音声再生は自然な話し方で行われるため、相手に不自然さを感じさせず、効果的なコミュニケーションを実現します。

8. **情報収集達成の判定**

   - **ChatGPTによる達成判定**: 目的の情報の収集が完了したか否かがChatGPTにより判定されます。十分な情報収集が行われたと判定された場合には通話を終了し、追加の情報収集が必要と判断された場合には4~7のプロセスを繰り返し実行し、ヒアリングを継続することで、抜け漏れの無い情報の取得を可能にします。

9. **収集した情報のエクセルへの記録**

   - **収集情報の記録**: 通話を通じて得られた物件の空き状況や詳細情報は、Excelファイルに自動的に記録されます。この情報は後で確認・分析できるように整理され、効率的なデータ管理をサポートします。Excelへの自動記録により、人的ミスの防止とデータの一元管理が可能となり、業務効率を高めます。

10. **通話音声とテキスト化された会話履歴の保存**

   - **会話履歴の記録**: テキスト化された音声データは会話履歴として保存されます。この履歴は次の応答生成時に参考として使用されるほか、後でデータ分析やレポート作成に活用されます。保存された会話履歴は、通話内容を再確認する際や、相手とのコミュニケーションの質を高めるための資料としても役立ちます。

11. **通話終了と次のプロセスへの移行**

   - **通話の終了と次の発信**: 必要な情報がすべて収集された時点で通話を終了し、次の物件に対する通話プロセスに移行します。このプロセスを自動化することで、多数の物件に対して効率的に情報収集が行われ、人的リソースの大幅な削減が可能となります。また、スムーズに次の通話に移行することで、時間の有効活用にも繋がります。

## 🔄 音声ファイル処理

- **音声の結合**: 録音された音声ファイルはPydubを使って結合し、全ての通話履歴を1つのファイルとして保存します。これにより、一連の通話を後から通して確認することができます。
- **音声テキスト化**: Whisper APIを使用して音声をテキストに変換します。これにより、通話内容を自動的に分析し、次にどう対応すべきかを判断します。

## 🌍 ユースケースシナリオ

- **不動産管理会社**: 管理物件の空き情報を効率的に確認するための自動発信システムとして利用可能です。
- **賃貸仲介業者**: 多数の物件に対して空室確認を行う必要がある場合、人手をかけずに自動で情報を取得することができます。
- **ホテルチェーン**: 複数の施設の空室状況を確認し、顧客に迅速に情報提供するためのシステムとして利用可能です。
- **テレマーケティング企業**: 一般的な問い合わせに対する自動応答システムとして活用し、顧客との基本的なやり取りを自動化することができます。
- **建物オーナー向けの情報収集**: 所有する複数のビルの入居状況を自動的に収集し、次の意思決定に役立てることができます。
- **コールセンターの効率化**: 繰り返し行われる問い合わせや情報収集を自動化することで、コールセンター業務の効率化とコスト削減に寄与します。
- **法人営業チーム**: 顧客との事前情報収集を自動化することで、営業担当者がより深い価値提供に専念できるようになります。

## 🔐 セキュリティに関する詳細

本システムでは、TwilioやOpenAIのAPIキーなどのセンシティブな情報を.envファイルに保存し、コード内に直接記述しないことで情報漏洩のリスクを最小限に抑えています。また、APIキーは使用時に環境変数から読み込む形をとることで、安全に管理されています。

さらに、外部との通信にはHTTPSを使用し、情報が暗号化されて送信されるようにしています。これにより、第三者による盗聴や改ざんを防ぎ、通話内容や認証情報のセキュリティを確保しています。

## 🔑 APIキーや認証情報の取得手順

- **TwilioのAPIキー取得**:
  1. Twilio公式サイトにアクセスし、アカウントを作成します。
  2. ダッシュボードからAccount SIDとAuth Tokenを取得し、.envファイルに追加します。

- **OpenAIのAPIキー取得**:
  1. OpenAIの公式サイトにアクセスし、アカウントを作成します。
  2. APIキーを取得し、.envファイルに追加します。

- **ngrokの設定**:
  1. ngrok公式サイトにアクセスし、アカウントを作成します。
  2. ダウンロードしたngrokをセットアップし、ngrokの認証トークンを設定します。

## 🛠 今後の改善

- **エラーハンドリングの強化**: 通話中に発生し得るエラーへの対応を強化し、システムの安定性を向上させます。
- **GUIの導入**: システムを視覚的に操作できるよう、グラフィカルユーザーインターフェース（GUI）を追加します。
- **スケジュール機能**: 定期的に自動発信する機能を追加し、継続的な情報収集を可能にします。
- **複数言語対応**: 他言語での応対も可能にし、異なる市場や顧客への対応力を高めます。

## 💡 貢献

このプロジェクトに対する機能追加や改善提案があれば、ぜひリポジトリをフォークしてプルリクエストを送ってください。皆さんの協力をお待ちしています！

## 📧 連絡先

質問や提案がある場合は、takeushi001@gmail.comまでご連絡ください。
